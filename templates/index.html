{% extends "base.html" %}

{% block title %}Home - {{ super() }}{% endblock %}

{% block content %}

    <!-- Hero Section -->
    <section id="hero" class="d-flex align-items-center text-center py-5 px-3 text-white overflow-hidden">
        <div class="container position-relative" style="z-index: 2;">
            <div data-aos="fade-down">
                <h1 class="display-2 fw-bold mb-3">AI-Powered <span class="highlight-gradient">Homebrew</span></h1>
                <p class="lead mb-4 mx-auto fw-light" style="max-width: 650px;">Instantly generate limitless TTRPG content. Build unique worlds, compelling characters, and thrilling adventures with your AI co-creator.</p>
            </div>
            <a href="#pricing" class="btn btn-lg custom-btn custom-btn-warning shadow-lg fw-bold mt-3" data-aos="fade-up" data-aos-delay="300">
                <i class="bi bi-stars me-2"></i>Start Creating Now <i class="bi bi-chevron-right ms-1"></i>
            </a>
        </div>
        <div class="hero-shapes"></div>
    </section>

    <!-- Features Section -->
    <section id="features" class="py-5 section-bg-accent">
        <div class="container">
            <h2 class="text-center mb-5 display-5 text-white" data-aos="fade-up">Your Creative Toolkit</h2>
            <div class="row g-4 justify-content-center">
                 <div class="col-lg-4 col-md-6" data-aos="zoom-in-up" data-aos-delay="100">
                    <div class="feature-card modern-card p-4 text-center">
                        <div class="feature-icon mb-3"><i class="bi bi-brightness-high-fill"></i></div>
                        <h4 class="fw-bold mb-2">World Genesis</h4>
                        <p class="small">Craft unique settings, cultures, histories, and maps from simple prompts.</p>
                    </div>
                 </div>
                 <div class="col-lg-4 col-md-6" data-aos="zoom-in-up" data-aos-delay="250">
                     <div class="feature-card modern-card p-4 text-center">
                        <div class="feature-icon mb-3"><i class="bi bi-people-fill"></i></div>
                        <h4 class="fw-bold mb-2">Character Forge</h4>
                        <p class="small">Generate diverse NPCs & Monsters with deep personalities and motivations.</p>
                    </div>
                 </div>
                 <div class="col-lg-4 col-md-6" data-aos="zoom-in-up" data-aos-delay="400">
                     <div class="feature-card modern-card p-4 text-center">
                        <div class="feature-icon mb-3"><i class="bi bi-journal-richtext"></i></div>
                        <h4 class="fw-bold mb-2">Adventure Crafting</h4>
                        <p class="small">Design plot hooks, balanced encounters, custom items, spells, and rules.</p>
                    </div>
                 </div>
            </div>
        </div>
    </section>

    <!-- How it Works Section -->
     <section id="how-it-works" class="py-5">
        <div class="container">
             <h2 class="text-center mb-5 display-5" data-aos="fade-up">Launch Your Campaign Fast</h2>
            <div class="row text-center g-5 align-items-center">
                <div class="col-md-4" data-aos="fade-right" data-aos-delay="100">
                    <div class="step-icon mb-3"><i class="bi bi-person-plus-fill"></i></div>
                    <h4 class="fw-bold fs-5">1. Sign Up Free</h4>
                    <p class="text-muted small">Quick account creation.</p>
                </div>
                 <div class="col-md-4" data-aos="fade-up" data-aos-delay="250">
                    <div class="step-icon mb-3"><i class="bi bi-credit-card-2-front-fill"></i></div>
                    <h4 class="fw-bold fs-5">2. Get Credit</h4>
                    <p class="text-muted small">One-time €10 purchase.</p>
                </div>
                 <div class="col-md-4" data-aos="fade-left" data-aos-delay="400">
                    <div class="step-icon mb-3"><i class="bi bi-lightbulb-fill"></i></div>
                    <h4 class="fw-bold fs-5">3. Create Magic</h4>
                    <p class="text-muted small">Generate endless content.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Pricing Section -->
    <section id="pricing" class="py-5 section-bg-accent">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-6" data-aos="flip-up">
                    <div class="card pricing-card modern-card text-center border-0 overflow-hidden">
                         <div class="card-header pricing-header pt-4 pb-3 border-0">
                            <h4 class="my-0 fw-bold text-primary">Homebrew Build Credit</h4>
                        </div>
                        <div class="card-body p-4">
                            <div class="pricing-tag mb-4">
                                €10 <span class="pricing-term">/ Project</span>
                            </div>
                            <ul class="list-unstyled mt-3 mb-4 text-center small">
                                <li><i class="bi bi-check-circle text-success me-2"></i>Full AI Tool Access</li>
                                <li><i class="bi bi-check-circle text-success me-2"></i>Extensive Generation*</li>
                                <li><i class="bi bi-check-circle text-success me-2"></i>Build a Complete Homebrew</li>
                                <li><i class="bi bi-check-circle text-success me-2"></i>No Subscriptions</li>
                            </ul>
                            {# Purchase button initially hidden by d-none, JS will show it #}
                            <button type="button" class="w-100 btn btn-lg custom-btn custom-btn-primary rounded-pill purchase-button d-none" id="purchase-button">
                                <i class="bi bi-wallet-fill me-2"></i> Buy credits
                            </button>
                            <small class="d-block text-muted mt-3 small">*Approx. 100 AI interactions.</small>
                        </div>
                        <div class="pricing-glow"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

<!-- AI Tool Section - CORRECTED HTML STRUCTURE -->
<section id="ai-tool" class="py-5 text-center">
    <div class="container" data-aos="fade-up">
        <h2 class="mb-4 display-5">The Adventure Forge</h2>

        {# Tool Access Area Container - Always rendered #}
        <div id="tool-access-area">

                {# Login/Credit Prompt - Initially visible, JS will hide if needed #}
                <p class="lead text-muted mb-4" id="tool-access-prompt">
                    {# Default message, JS might change this or hide it #}
                    Please <a href="#" data-action="login" class="link-primary">Login or Sign Up</a> to use the AI tools.
                </p>

                 {# Chat Area Container - Always rendered, visibility controlled by JS #}
                 <div id="chat-interface-container" class="d-none"> {# Initially hidden by d-none #}

                     {# --- WRAPPER for Top Section (Sidebar + Chat History) --- #}
                     <div id="chat-main-area" class="chat-main-area"> 
                         {# --- CHAT FULLSCREEN SIDEBAR --- #}
                         <div id="chat-fullscreen-sidebar" class="d-none"> 
                             <div class="conversation-sidebar-header d-flex justify-content-between align-items-center">
                                <span>Conversations</span>
                                <button id="new-conversation-btn" class="btn btn-sm btn-link p-0 ms-2" title="New Conversation"><i class="bi bi-plus-circle"></i></button>
                            </div>
                            <ul id="conversation-list" class="conversation-list"></ul>
                         </div>
                         {# --- CHAT HISTORY AREA --- #}
                         <div id="ai-result-output" class="mb-3 text-start result-area p-3 rounded chat-container">
                             <div id="chat-message-list">
                                 {# Messages go here (Initial prompt might be here) #}
                                  <p class="text-muted small text-center initial-chat-prompt">Loading chat...</p>
                             </div>
                             <div id="chat-error"></div>
                         </div>
                     </div>
                     {# --- END WRAPPER --- #}

                     {# --- INPUT FORM AREA (Sibling to the wrapper) --- #}
                     <form id="ai-generation-form"
                           class="ai-tool-form mx-auto"
                           action="/api/v1/chat/message" method="post"
                           style="max-width: 90%;">
                          <div class="d-flex align-items-center w-100">
                              <label for="ai-prompt-input" class="form-label visually-hidden">AI Prompt</label>
                              <textarea class="form-control form-control-lg bg-light me-2" id="ai-prompt-input" name="prompt" rows="1" style="resize: none; height: auto; flex: 1 1 auto;" placeholder="Enter your prompt here..." required disabled></textarea> {# Initially disabled #}
                              <button type="submit" id="ai-generate-button" class="btn btn-lg custom-btn custom-btn-secondary flex-shrink-0" disabled> {# Initially disabled #}
                                  <i class="bi bi-magic"></i>
                              </button>
                              <div id="ai-loading-indicator" class="spinner-border spinner-border-sm ms-2" role="status" style="display:none;">
                                  <span class="visually-hidden">Loading...</span>
                              </div>
                          </div>
                      </form>

                     {# --- Zoom Button (Position relative to tool-access-area) --- #}
                     <button id="chat-zoom-toggle" class="chat-zoom-btn" title="Toggle fullscreen mode">
                         <i class="bi bi-arrows-fullscreen"></i>
                     </button>

                </div> {# End chat-interface-container #}
        </div> {# End tool-access-area #}
    </div> {# End container #}
</section>

{% endblock %}

{% block scripts %}
    {# Optionally call super() if base.html has scripts needed by index #}
    {{ super() if super }}
    {# Index page specific scripts if any (like the removed HTMX helper) could go here #}
    <script>
         console.log("Index page specific script block loaded (can be empty).");
    </script>
{% endblock %}