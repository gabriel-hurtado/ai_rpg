/* static/chat.css - v20 - Flexbox FS Layout, Mobile Zoom Button Fix */

/* Base body padding (adjust if navbar height changes) */
body {
  padding-top: 64px; /* Example, match your actual navbar height */
}

/* Z-INDEX Variables */
:root {
--z-navbar: 9000;
/* No specific z-index needed for flex children usually */
--z-zoom-button: 9500;    /* Button needs to be on top */
--form-min-height-fs: 80px; /* Define form min height for reuse */
}

/* Navbar Styling (Ensure this matches your base theme or add specific styles) */
.navbar.site-header {
  position: fixed !important; top: 0; left: 0; width: 100%;
  z-index: var(--z-navbar) !important;
  background-color: #171721 !important; /* Example */
  box-shadow: 0 2px 10px rgba(0,0,0,0.2); /* Example */
  /* Add other relevant navbar styles from style.css if needed for consistency */
}

/* --- NORMAL VIEW STYLING --- */

/* Chat Container (Normal View) */
.chat-container {
position: relative;
height: 400px; /* Default height */
overflow-y: auto; /* Enable scrolling */
border-radius: 12px;
background: #1e1e24;
padding: 15px;
margin-bottom: 20px;
border: 1px solid var(--color-border, rgba(255, 255, 255, 0.12));
/* Scrollbar Styling */
scrollbar-width: thin;
scrollbar-color: rgba(var(--color-primary-rgb, 212, 175, 55), 0.3) transparent;
}
.chat-container::-webkit-scrollbar { width: 6px; height: 6px; }
.chat-container::-webkit-scrollbar-track { background: transparent; }
.chat-container::-webkit-scrollbar-thumb { background: rgba(var(--color-primary-rgb, 212, 175, 55), 0.3); border-radius: 3px; }
.chat-container::-webkit-scrollbar-thumb:hover { background: rgba(var(--color-primary-rgb, 212, 175, 55), 0.5); }

/* Chat Message List (Normal View) */
#chat-message-list {
display: flex;
flex-direction: column;
gap: 12px;
padding-bottom: 5px; /* Minimal bottom padding */
}

/* Message Styling (Common) */
.chat-message {
border-radius: 16px;
padding: 10px 15px; /* Adjusted padding */
max-width: 80%;
word-wrap: break-word;
margin-bottom: 10px; /* Slightly reduced margin */
line-height: 1.6;
font-size: 1rem; /* 16px */
box-shadow: 0 1px 3px rgba(0,0,0,0.2); /* Softer shadow */
opacity: 1 !important;
visibility: visible !important;
}
.chat-message strong { /* "You:", "AI:" */
  font-weight: 600;
  display: block;
  margin-bottom: 4px;
  font-size: 0.85em;
  opacity: 0.8;
}
.chat-message p { margin: 0; max-width: none; }
.chat-message .markdown-content { margin: 0; padding: 0; }
.chat-message .markdown-content p { margin-bottom: 0.5rem; }
.chat-message .markdown-content p:last-child { margin-bottom: 0; }
.chat-message .markdown-content pre {
  background-color: rgba(0,0,0,0.2); padding: 10px;
  border-radius: 5px; overflow-x: auto; font-size: 0.9em;
  border: 1px solid var(--color-border, rgba(255, 255, 255, 0.1));
  white-space: pre-wrap; /* Wrap long lines in code blocks */
  word-wrap: break-word; /* Break words if needed */
}
.chat-message .markdown-content code:not(pre code) { /* Inline code */
  background-color: rgba(0,0,0,0.2); padding: 0.2em 0.4em;
  border-radius: 3px; font-size: 0.9em;
  word-wrap: break-word; /* Allow inline code to wrap */
}
.chat-message .markdown-content ul,
.chat-message .markdown-content ol {
  padding-left: 20px; /* Indent lists */
  margin-bottom: 0.5rem;
}

/* User Message */
.user-message {
background: linear-gradient(135deg, #ffda95, #ffb860);
color: #1a1a1a !important; /* Dark text */
margin-left: auto; /* Align right */
border-bottom-right-radius: 4px;
}
.user-message strong, .user-message p { color: inherit !important; }

/* AI Message */
.ai-message {
background: #282836;
color: #f0f0f0 !important; /* Light text */
margin-right: auto; /* Align left */
border-bottom-left-radius: 4px;
}
.ai-message strong, .ai-message .markdown-content * { color: inherit !important; }


/* --- FULLSCREEN MODE STYLES --- */

/* Hide other page elements */
body.chat-fullscreen-active .page-wrapper > *:not(header):not(main),
body.chat-fullscreen-active main > *:not(#ai-tool) {
display: none !important;
}

/* Make AI tool section cover viewport below navbar */
body.chat-fullscreen-active #ai-tool {
position: fixed !important;
top: 64px !important; /* Match navbar height */
left: 0 !important; right: 0 !important; bottom: 0 !important;
margin: 0 !important; padding: 0 !important;
overflow: hidden !important; /* Prevent scroll on this outer container */
}
/* Hide headings inside */
body.chat-fullscreen-active #ai-tool h2,
body.chat-fullscreen-active #ai-tool > .container > p.lead { display: none !important; }
/* Container takes full space */
body.chat-fullscreen-active #ai-tool .container {
max-width: 100% !important; width: 100% !important; height: 100% !important;
padding: 0 !important; margin: 0 !important;
display: flex !important; flex-direction: column !important;
}

/* Tool area takes full space, uses FLEXBOX */
body.chat-fullscreen-active #tool-access-area {
  width: 100%; height: 100%;
  position: relative; /* For zoom button positioning */
  display: flex !important; /* <<< KEY: Enable Flexbox */
  flex-direction: column !important; /* <<< KEY: Stack Vertically */
  overflow: hidden !important; /* Prevent scroll here */
}

/* Chat Container in Fullscreen (Flexible, Scrollable) */
body.chat-fullscreen-active .chat-container {
/* --- Flexbox Properties --- */
flex-grow: 1 !important;   /* Take available space */
flex-shrink: 1 !important; /* Allow shrinking */
flex-basis: 0% !important;  /* Start with no initial size */
overflow-y: auto !important; /* Allow vertical scroll */
/* --- Reset Positioning --- */
position: relative !important; /* No absolute/fixed */
top: auto !important; bottom: auto !important; left: auto !important; right: auto !important;
height: auto !important; /* Let flexbox control height */
/* --- Styling --- */
width: 100% !important; max-width: none !important;
border-radius: 0 !important; border: none !important;
background: #1e1e24 !important;
padding: 15px 20px !important; /* Inner padding */
margin: 0 !important;
z-index: auto; /* Reset z-index */
 /* Scrollbar Styling */
scrollbar-width: thin;
scrollbar-color: rgba(var(--color-primary-rgb, 212, 175, 55), 0.3) transparent;
}
body.chat-fullscreen-active .chat-container::-webkit-scrollbar { width: 6px; }
body.chat-fullscreen-active .chat-container::-webkit-scrollbar-track { background: transparent; }
body.chat-fullscreen-active .chat-container::-webkit-scrollbar-thumb { background: rgba(var(--color-primary-rgb, 212, 175, 55), 0.3); border-radius: 3px; }
body.chat-fullscreen-active .chat-container::-webkit-scrollbar-thumb:hover { background: rgba(var(--color-primary-rgb, 212, 175, 55), 0.5); }


/* Chat Message List in Fullscreen (Minimal padding ok now) */
body.chat-fullscreen-active #chat-message-list {
 padding-bottom: 10px !important; /* Minimal padding */
}

/* Form at Bottom in Fullscreen (No Flex Grow/Shrink) */
body.chat-fullscreen-active #ai-generation-form {
/* --- Flexbox Properties --- */
flex-grow: 0; /* Don't grow */
flex-shrink: 0; /* Don't shrink */
/* --- Reset Positioning --- */
position: relative !important; /* No absolute/fixed */
bottom: auto !important; left: auto !important; right: auto !important;
/* --- Styling --- */
z-index: auto; /* Reset z-index */
background: #111114 !important;
border-top: 1px solid #333 !important;
padding: 15px 0 !important; /* Vertical padding */
margin: 0 !important;
max-width: 100% !important; width: 100% !important;
min-height: var(--form-min-height-fs, 80px) !important; /* Ensure min height */
box-shadow: 0 -2px 10px rgba(0,0,0,0.3) !important;
display: flex !important; /* Use flex for centering inner div */
justify-content: center !important;
align-items: center !important; /* Vertically center content (mostly for single line) */
/* NO height transitions */
}

/* Form inner div (Centering content) */
body.chat-fullscreen-active #ai-generation-form > div {
width: 95% !important; max-width: 1800px !important; /* Limit width */
display: flex !important;
align-items: flex-end !important; /* Align button and textarea bottom */
gap: 10px !important;
}

/* Textarea Styling in Fullscreen (Allow auto-resize) */
body.chat-fullscreen-active textarea#ai-prompt-input {
flex-grow: 1 !important; /* Take available width */
min-height: 46px !important;
max-height: 300px !important; /* Limit growth */
resize: none !important; /* Disable manual handle */
overflow-y: auto !important; /* Scroll inside if exceeds max-height */
/* Visual styling */
background: rgba(30, 30, 45, 0.7) !important;
color: white !important;
border: 1px solid rgba(80, 80, 100, 0.5) !important;
border-radius: 24px !important;
padding: 12px 20px !important;
line-height: 1.5 !important;
font-size: 16px !important;
box-shadow: none !important;
/* NO height transitions */
/* Scrollbar styling */
scrollbar-width: thin;
scrollbar-color: rgba(var(--color-primary-rgb, 212, 175, 55), 0.3) transparent;
}
/* ... webkit scrollbar styles for textarea ... */
body.chat-fullscreen-active textarea#ai-prompt-input::-webkit-scrollbar { width: 6px; }
body.chat-fullscreen-active textarea#ai-prompt-input::-webkit-scrollbar-track { background: transparent; }
body.chat-fullscreen-active textarea#ai-prompt-input::-webkit-scrollbar-thumb { background: rgba(var(--color-primary-rgb, 212, 175, 55), 0.3); border-radius: 3px; }
body.chat-fullscreen-active textarea#ai-prompt-input::-webkit-scrollbar-thumb:hover { background: rgba(var(--color-primary-rgb, 212, 175, 55), 0.5); }


/* Button Styling in Fullscreen */
body.chat-fullscreen-active #ai-generate-button {
 /* Restore original styling */
 background: #ffd580; color: #222; border: none;
 border-radius: 50%; width: 46px; height: 46px;
 min-width: 46px; padding: 0;
 display: flex; align-items: center; justify-content: center;
 box-shadow: 0 2px 8px rgba(0,0,0,0.2);
 transition: transform 0.2s ease, box-shadow 0.2s ease;
 flex-shrink: 0; /* Don't shrink */
 margin-bottom: 0; /* Align with bottom of textarea */
}
body.chat-fullscreen-active #ai-generate-button:hover { transform: scale(1.05); }
body.chat-fullscreen-active #ai-generate-button i { font-size: 18px; }

/* Zoom Button Styling (Positioned absolutely within tool-access-area) */
.chat-zoom-btn {
position: absolute; /* <<< Position relative to #tool-access-area */
bottom: 20px; /* Default position from bottom of PARENT */
right: 20px; /* Default position from right of PARENT */
width: 45px; height: 45px; /* Size */
border-radius: 50%;
background: var(--color-bg-lighter, #3D3D4B);
color: var(--color-primary, #D4AF37);
border: 1px solid var(--color-border, rgba(255, 255, 255, 0.12));
font-size: 1.1rem;
display: flex; align-items: center; justify-content: center;
cursor: pointer;
z-index: var(--z-zoom-button) !important; /* Highest */
box-shadow: var(--shadow-md);
transition: all 0.2s ease;
}
.chat-zoom-btn:hover {
  background-color: var(--color-primary, #D4AF37);
  color: var(--color-bg-dark, #101014);
  transform: scale(1.05);
  border-color: var(--color-primary, #D4AF37);
}

/* Position Zoom Button near bottom right in FULLSCREEN (DEFAULT) */
body.chat-fullscreen-active .chat-zoom-btn {
  /* Position relative to the #tool-access-area */
  top: 20px; /* Adjust spacing from bottom form */
  right: 25px;
  bottom: auto; /* Ensure top is not set */
}

/* --- Mobile Fullscreen Override for Zoom Button --- */
/* Apply only when fullscreen AND screen is narrow */
@media (max-width: 767px) {
body.chat-fullscreen-active .chat-zoom-btn {
  top: 15px;    /* <<< Move to TOP right on mobile */
  right: 15px;   /* Distance from right */
  bottom: auto; /* <<< REMOVE bottom positioning */
}
}

/* Prevent body scroll in Fullscreen */
body.chat-fullscreen-active { overflow: hidden !important; }

/* Textarea Styling (Normal View) */
#ai-prompt-input {
resize: none; /* Disable manual resize handle always */
overflow-y: auto; /* Allow internal scroll */
min-height: 46px; /* Base height */
/* Inherit scrollbar styles */
scrollbar-width: thin;
scrollbar-color: rgba(var(--color-primary-rgb, 212, 175, 55), 0.3) transparent;
}
#ai-prompt-input::-webkit-scrollbar { width: 6px; }
#ai-prompt-input::-webkit-scrollbar-track { background: transparent; }
#ai-prompt-input::-webkit-scrollbar-thumb { background: rgba(var(--color-primary-rgb, 212, 175, 55), 0.3); border-radius: 3px; }
#ai-prompt-input::-webkit-scrollbar-thumb:hover { background: rgba(var(--color-primary-rgb, 212, 175, 55), 0.5); }

/* Ensure form layout is correct in normal view too */
#ai-generation-form {
display: flex;
justify-content: center; /* Center inner div */
}
#ai-generation-form > div {
width: 90%; /* Or your desired normal width */
max-width: 900px; /* Example max width */
display: flex;
align-items: flex-end; /* Align button to bottom */
gap: 10px;
}
#ai-generation-form #ai-prompt-input {
  flex-grow: 1; /* Take space */
}
#ai-generation-form #ai-generate-button {
  flex-shrink: 0; /* Don't shrink */
}